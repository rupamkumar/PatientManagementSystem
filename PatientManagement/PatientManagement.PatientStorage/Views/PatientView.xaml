<UserControl x:Class="PatientManagement.PatientStorage.Views.PatientView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:controls="clr-namespace:PatientManagement.PatientStorage.Views.Controls"
             xmlns:views="clr-namespace:PatientManagement.PatientStorage.Views"              
             MinHeight="450" MinWidth="800">
    <UserControl.Resources>
        <ResourceDictionary Source="../Styles/Theme.xaml">

        </ResourceDictionary>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200" />
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="15"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="15"/>
        </Grid.RowDefinitions>
        <!--<ListView ItemsSource="{Binding Patients}" Background="#333333" Foreground="#CCCCCC"
                  SelectedItem="{Binding SelectedPatient, Mode=TwoWay}"
                  DisplayMemberPath="FirstName" />-->
        <TextBlock x:Name="txtEventMessages" VerticalAlignment="top" FontSize="12" Text ="" Grid.Row="1" Grid.Column="0" Background="#333333" Foreground="OrangeRed"/>
        <views:SearchView Grid.Column="0" Grid.Row="2" DataContext="{Binding _searchViewModel}"/>
        <views:NavigationView Grid.Column="0" DataContext="{Binding _navigationViewModel}" Grid.Row="3" />
        <GridSplitter Grid.Row="2" Grid.RowSpan="2" Grid.Column="1" Width="1" Background="#555555" HorizontalAlignment="Center"/>

        <TabControl ItemsSource="{Binding PatientEditViewModels}"
                SelectedItem="{Binding SelectedPatientEditViewModel, Mode=TwoWay}" 
                Grid.Row="2" Grid.RowSpan="2" Grid.Column="2" Background="#333333" BorderThickness="0.5">
            <TabControl.ItemContainerStyle>
                <Style TargetType="TabItem" BasedOn="{StaticResource {x:Type TabItem}}">
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="FontWeight" Value="Bold"/>
                            <Setter Property="Foreground" Value="#264662"/>
                            <Setter Property="Background" Value="#FFCCDCEA"/>
                        </Trigger>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self},
              Path=Content.Patient.IsChanged}" Value="True">
                            <Setter Property="Background" Value="{StaticResource IsChangedBackgroundBrush}"/>
                        </DataTrigger>
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self},
              Path=Content.Patient.IsValid}" Value="False">
                            <Setter Property="Background" Value="{StaticResource HasErrorBackgroundBrush}"/>
                        </DataTrigger>
                    </Style.Triggers>
                    <Setter Property="Foreground" Value="#778899"/>
                    <Setter Property="Background" Value="#454545"/>
                </Style>
            </TabControl.ItemContainerStyle>
            <TabControl.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Patient.FirstName,ValidatesOnNotifyDataErrors=False}"/>
                        <TextBlock Text="{Binding Patient.LastName}" Margin="5 0 20 0"/>                        
                        <Button Command="{Binding RelativeSource=
                                  {RelativeSource FindAncestor,
                                  AncestorType={x:Type TabControl}},
                                  Path=DataContext.ClosePatientTabCommand}" 
                                CommandParameter="{Binding}"
                                Width="12" Height="12" FontWeight="Bold"   Style="{StaticResource RemoveButtonStyle}"
                                Padding="0">
                        </Button>
                    </StackPanel>
                </DataTemplate>
            </TabControl.ItemTemplate>
            <TabControl.ContentTemplate>
                <DataTemplate>
                    <views:PatientEditView  />
                </DataTemplate>
            </TabControl.ContentTemplate>

        </TabControl>
        <controls:ChangeTrackingCollectionInfo DataContext="{Binding Patient, ValidatesOnNotifyDataErrors=True}"
       Grid.Row="5"  Grid.ColumnSpan="4"/>
        <!--<TextBlock Text="{Binding SelectedPatient.FirstName}"  ></TextBlock>-->
        <!--<TextBlock Text="From PatientModuleManager ViewB" FontSize="32" HorizontalAlignment="Center" VerticalAlignment="Center"/>-->
    </Grid>
</UserControl>
